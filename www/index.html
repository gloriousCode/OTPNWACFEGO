<!doctype html>
<html>

<head>
    <script src="jquery-3.4.1.min.js"></script>
    <title>OTPNWACFEGO</title>
    <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="decrypt-prompt">
        <input id="key" />
        <div id="key-btn" class="btn btn-decr">DECRYPT</div>
    </div>

    <div class="the-thing"></div>
    <script>
        $(document).ready(function() {
            var butts
            var isLoaded = false
            setInterval(function() {
                render();
            }, 1000);


            document.querySelector('#key-btn').addEventListener('click', async() => {
                setKey();
            });

            // We use async/await because Go functions are asynchronous
            const render = async() => {
                isLoaded = await isConfigLoaded();
                if (!isLoaded) {
                    $(".decrypt-prompt").show();
                    $(".the-thing").hide();
                    return
                } else {
                    $(".decrypt-prompt").hide();
                    $(".the-thing").show();
                }
                var codes = await getCodes();
                var first = true
                $.each(codes, function(index, value) {
                    outputDivs(codes[index][0], codes[index][1], codes[index][2], first)
                    first = false
                });
            };



            function outputDivs(name, code, counter, first) {
                var remainingClass = "remaining"
                if (counter == "5s" ||
                    counter == "4s" ||
                    counter == "3s" ||
                    counter == "2s" ||
                    counter == "1s" ||
                    counter == "0s") {
                    remainingClass = "urgent"
                }
                var html = `
                <div class="counter-container">
                    <h4 class="` + remainingClass + `">` + name + ` - ` + counter + `</h4>
                    <div class="btn-row">
                        <input type="text" class="counter" value="` + code + `" id="` + name + `">
                        <div id="` + name + `-btn" class="btn btn-decr">COPY</div>
                    </div>
                </div>
                `
                if (first == true) {
                    $(".the-thing").html(html)
                } else {
                    $(".the-thing").append(html)
                }

                $("#" + name + "-btn").click(function() {
                    var copyText = document.getElementById(name);
                    copyText.select();
                    copyText.setSelectionRange(0, 99999); /*For mobile devices*/
                    document.execCommand("copy");
                });
            }

            render();
        })
    </script>
</body>

</html>