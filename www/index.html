<!doctype html>
<html>

<head>
    <script src="jquery-3.4.1.min.js"></script>
    <title>OTPNWACFEGO</title>
    <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="the-thing"></div>
    <script>
        $(document).ready(function () {
            var butts
            setInterval(function () {
                async () => {
                    await getCodes();
                }
                render();
            }, 1000);

            // We use async/await because Go functions are asynchronous
            const render = async () => {
                var codes = await getCodes();
                var first = true
                $.each(codes, function (index, value) {
                    outputDivs(codes[index][0], codes[index][1], codes[index][2], first)
                    first = false
                });
            };

            function outputDivs(name, code, counter, first) {
                var remainingClass = "remaining"
                if (counter == "5s" ||
                    counter == "4s" ||
                    counter == "3s" ||
                    counter == "2s" ||
                    counter == "1s" ||
                    counter == "0s") {
                    remainingClass = "urgent"
                }
                var html = `
                <div class="counter-container">
                    <h4 class="`+ remainingClass + `">`+ name + ` - ` + counter + `</h4>
                    <div class="btn-row">
                        <input type="text" class="counter" value="`+ code + `" id="` + name + `">
                        <div id="`+ name + `-btn" class="btn btn-decr">COPY</div>
                    </div>
                </div>
                `
                if (first == true) {
                    $(".the-thing").html(html)
                } else {
                    $(".the-thing").append(html)
                }

                $("#" + name + "-btn").click(function () {
                    var copyText = document.getElementById(name);
                    copyText.select();
                    copyText.setSelectionRange(0, 99999); /*For mobile devices*/
                    document.execCommand("copy");
                });
            }

            render();
        })
    </script>
</body>

</html>